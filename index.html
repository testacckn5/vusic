<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vzo's music app</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #fff;
            overflow: hidden;
        }

        .glass-header {
            background: rgba(9, 9, 11, 0.7);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(39, 39, 42, 0.5);
        }

        .spotify-card:hover .play-btn {
            opacity: 1;
            transform: translateY(0);
        }

        input[type='range'] {
            accent-color: #6366f1;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #27272a;
            border-radius: 10px;
        }

        .playing-active {
            color: #6366f1;
        }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- App Container -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-64 bg-zinc-950 p-6 hidden md:flex flex-col gap-8 border-r border-zinc-900">
            <div class="flex items-center gap-2 px-2">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-music text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-bold tracking-tight">vzo's music</h1>
            </div>

            <nav class="flex flex-col gap-5">
                <a href="#" class="flex items-center gap-4 text-white font-semibold px-2">
                    <i class="fas fa-home text-lg"></i> Home
                </a>
                <a href="#" class="flex items-center gap-4 text-zinc-400 hover:text-white transition px-2">
                    <i class="fas fa-search text-lg"></i> Search
                </a>
                <a href="#" class="flex items-center gap-4 text-zinc-400 hover:text-white transition px-2">
                    <i class="fas fa-book-open text-lg"></i> Your Library
                </a>
            </nav>

            <div class="mt-4 flex flex-col gap-4">
                <p class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest px-2">Playlists</p>
                <button class="text-sm text-zinc-400 hover:text-white text-left px-2">Liked Songs</button>
                <button class="text-sm text-zinc-400 hover:text-white text-left px-2">Heavy Rotation</button>
            </div>

            <div id="auth-section" class="mt-auto">
                <button id="login-btn" class="w-full bg-white text-black font-bold py-3 rounded-full text-sm hover:scale-105 transition">
                    Login with Spotify
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative overflow-y-auto bg-gradient-to-b from-zinc-900 to-black">
            <!-- Header -->
            <header class="sticky top-0 z-10 p-6 glass-header flex items-center justify-between">
                <div class="relative w-full max-w-md">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-zinc-500"></i>
                    <input 
                        id="search-input"
                        type="text" 
                        placeholder="Search for tracks..." 
                        class="w-full bg-zinc-800/80 border-none rounded-full py-2.5 pl-12 pr-4 text-sm focus:ring-2 focus:ring-indigo-500 transition outline-none"
                    >
                </div>
                <div class="flex items-center gap-4 pl-4">
                    <span id="user-display" class="hidden text-sm font-medium text-zinc-300">User</span>
                    <div class="w-9 h-9 rounded-full bg-indigo-600 flex items-center justify-center text-xs font-bold border-2 border-zinc-700">V</div>
                </div>
            </header>

            <!-- Grid Container -->
            <div id="content-area" class="p-8">
                <h2 id="view-title" class="text-3xl font-bold mb-8">Ready to play?</h2>
                <div id="results-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    <!-- Cards will be injected here -->
                </div>
                
                <div id="loader" class="hidden flex flex-col items-center justify-center py-20">
                    <i class="fas fa-circle-notch animate-spin text-indigo-500 text-4xl mb-4"></i>
                    <p class="text-zinc-500">Connecting to Spotify...</p>
                </div>
            </div>

            <div class="h-28"></div>
        </main>
    </div>

    <!-- Player Bar -->
    <footer class="h-24 bg-black border-t border-zinc-900 px-4 flex items-center justify-between z-20">
        <!-- Current Track -->
        <div class="flex items-center gap-4 w-1/3 min-w-0">
            <img id="player-img" src="https://via.placeholder.com/60" class="w-14 h-14 rounded shadow-lg bg-zinc-800" alt="">
            <div class="overflow-hidden">
                <h4 id="player-title" class="text-sm font-medium truncate">No track selected</h4>
                <p id="player-artist" class="text-xs text-zinc-400 truncate">Select a song to start</p>
            </div>
            <button class="text-zinc-500 hover:text-red-500 ml-2">
                <i class="far fa-heart"></i>
            </button>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center gap-2 w-1/3 max-w-xl">
            <div class="flex items-center gap-8">
                <button class="text-zinc-400 hover:text-white transition"><i class="fas fa-random text-sm"></i></button>
                <button class="text-zinc-400 hover:text-white transition text-lg"><i class="fas fa-step-backward"></i></button>
                <button id="master-play-btn" class="w-9 h-9 flex items-center justify-center bg-white rounded-full text-black hover:scale-105 transition">
                    <i class="fas fa-play ml-1"></i>
                </button>
                <button class="text-zinc-400 hover:text-white transition text-lg"><i class="fas fa-step-forward"></i></button>
                <button class="text-zinc-400 hover:text-white transition"><i class="fas fa-redo text-sm"></i></button>
            </div>
            
            <div class="flex items-center gap-3 w-full">
                <span id="current-time" class="text-[10px] text-zinc-500 w-10 text-right">0:00</span>
                <input id="progress-bar" type="range" value="0" step="0.1" class="flex-1 h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer">
                <span id="duration" class="text-[10px] text-zinc-500 w-10 text-left">0:30</span>
            </div>
        </div>

        <!-- Volume/Extras -->
        <div class="flex items-center justify-end gap-4 w-1/3">
            <button class="text-zinc-400 hover:text-white"><i class="fas fa-list-ul"></i></button>
            <div class="flex items-center gap-2 w-28">
                <i class="fas fa-volume-up text-zinc-400 text-xs"></i>
                <input id="volume-bar" type="range" value="70" class="w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer">
            </div>
        </div>
    </footer>

    <!-- Audio Element -->
    <audio id="main-audio"></audio>

    <script>
        // CONFIGURATION FROM YOUR UPLOADED IMAGE (Corrected Client ID)
        const CLIENT_ID = '3e44756a158e487eb31540648769226f';
        const REDIRECT_URI = 'https://testacckn5.github.io/vusic/';
        const AUTH_ENDPOINT = "https://accounts.spotify.com/authorize";
        const RESPONSE_TYPE = "token"; // Must be "token" for Implicit Grant
        const SCOPES = "user-read-private user-read-email";

        // State
        let accessToken = null;
        let currentTrackId = null;

        // Elements
        const loginBtn = document.getElementById('login-btn');
        const searchInput = document.getElementById('search-input');
        const resultsGrid = document.getElementById('results-grid');
        const viewTitle = document.getElementById('view-title');
        const loader = document.getElementById('loader');
        const audio = document.getElementById('main-audio');
        const masterPlayBtn = document.getElementById('master-play-btn');
        const progressBar = document.getElementById('progress-bar');
        const volumeBar = document.getElementById('volume-bar');

        // Initial Auth Check
        window.addEventListener('load', () => {
            const hash = window.location.hash;
            if (hash) {
                const params = new URLSearchParams(hash.substring(1));
                accessToken = params.get('access_token');
                if (accessToken) {
                    window.location.hash = ""; // Clean URL
                    onLoggedIn();
                } else if (params.get('error')) {
                    viewTitle.innerText = "Auth Error: " + params.get('error');
                    console.error("Spotify Auth Error:", params.get('error'));
                }
            }
        });

        // Login Logic
        loginBtn.addEventListener('click', () => {
            // Re-constructing query strictly to avoid "unsupported_response_type"
            const url = new URL(AUTH_ENDPOINT);
            url.searchParams.append('client_id', CLIENT_ID);
            url.searchParams.append('redirect_uri', REDIRECT_URI);
            url.searchParams.append('response_type', 'token'); // Explicitly set
            url.searchParams.append('scope', SCOPES);
            url.searchParams.append('show_dialog', 'true');
            
            window.location.href = url.toString();
        });

        function onLoggedIn() {
            document.getElementById('auth-section').innerHTML = `
                <div class="bg-zinc-900 rounded-lg p-4 border border-zinc-800">
                    <p class="text-xs text-zinc-500 mb-1">Authenticated as</p>
                    <p class="text-sm font-bold text-indigo-400">Vzo User</p>
                </div>
            `;
            viewTitle.innerText = "Discover Music";
            searchTracks('Lofi'); // Initial load
        }

        // Search Logic
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchTracks(searchInput.value);
        });

        async function searchTracks(query) {
            if (!accessToken) {
                alert("Please login with Spotify first!");
                return;
            }
            
            loader.classList.remove('hidden');
            resultsGrid.innerHTML = '';
            
            try {
                const response = await fetch(`https://api.spotify.org/v1/search?q=${encodeURIComponent(query)}&type=track&limit=20`, {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const data = await response.json();
                if (data.tracks && data.tracks.items) {
                    displayTracks(data.tracks.items);
                } else {
                    viewTitle.innerText = "No tracks found.";
                }
            } catch (err) {
                console.error(err);
                viewTitle.innerText = "Search failed. Session may have expired.";
            } finally {
                loader.classList.add('hidden');
            }
        }

        function displayTracks(tracks) {
            resultsGrid.innerHTML = tracks.map(track => `
                <div onclick="playTrack('${track.preview_url}', '${track.name.replace(/'/g, "\\'")}', '${track.artists[0].name.replace(/'/g, "\\'")}', '${track.album.images[0]?.url}', '${track.id}')" 
                     class="spotify-card bg-zinc-900/40 p-4 rounded-xl hover:bg-zinc-800 transition group cursor-pointer border border-zinc-800/50">
                    <div class="relative mb-4 aspect-square">
                        <img src="${track.album.images[0]?.url || 'https://via.placeholder.com/300'}" class="rounded-lg object-cover w-full h-full shadow-2xl bg-zinc-800" />
                        <div class="play-btn absolute bottom-2 right-2 w-12 h-12 bg-indigo-500 rounded-full flex items-center justify-center shadow-2xl transition opacity-0 transform translate-y-2">
                            <i class="fas fa-play text-white ml-1"></i>
                        </div>
                    </div>
                    <h3 class="font-bold truncate text-sm">${track.name}</h3>
                    <p class="text-zinc-400 text-xs truncate mt-1">${track.artists[0].name}</p>
                    ${!track.preview_url ? '<p class="text-[9px] text-red-400 mt-2 uppercase font-bold tracking-tighter">Preview unavailable</p>' : ''}
                </div>
            `).join('');
        }

        // Player Logic
        function playTrack(url, title, artist, img, id) {
            if (!url || url === 'null' || url === 'undefined') {
                alert("Spotify does not provide a preview for this specific track.");
                return;
            }

            if (currentTrackId === id) {
                togglePlay();
                return;
            }

            currentTrackId = id;
            audio.src = url;
            audio.play();
            
            document.getElementById('player-title').innerText = title;
            document.getElementById('player-artist').innerText = artist;
            document.getElementById('player-img').src = img;
            masterPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
        }

        function togglePlay() {
            if (!audio.src) return;
            if (audio.paused) {
                audio.play();
                masterPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audio.pause();
                masterPlayBtn.innerHTML = '<i class="fas fa-play ml-1"></i>';
            }
        }

        masterPlayBtn.addEventListener('click', togglePlay);

        audio.ontimeupdate = () => {
            const p = (audio.currentTime / audio.duration) * 100;
            progressBar.value = p || 0;
            document.getElementById('current-time').innerText = formatTime(audio.currentTime);
        };

        progressBar.oninput = () => {
            audio.currentTime = (progressBar.value / 100) * audio.duration;
        };

        volumeBar.oninput = () => {
            audio.volume = volumeBar.value / 100;
        };

        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }
    </script>
</body>
</html>
