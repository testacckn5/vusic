<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vzo's music app</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #050505;
            color: #fff;
            overflow: hidden;
        }

        .sidebar-item {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .glass-header {
            background: rgba(5, 5, 5, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .spotify-card {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .spotify-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-8px);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .play-btn-overlay {
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .spotify-card:hover .play-btn-overlay {
            opacity: 1;
            transform: translateY(0);
        }

        input[type='range'] {
            accent-color: #6366f1;
            height: 4px;
        }

        .hero-gradient {
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.15) 0%, rgba(5, 5, 5, 0) 100%);
        }

        ::-webkit-scrollbar {
            width: 5px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #222;
            border-radius: 10px;
        }
    </style>
</head>
<body class="h-screen flex flex-col selection:bg-indigo-500/30">

    <!-- App Container -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-72 bg-[#0a0a0a] p-6 hidden md:flex flex-col gap-8 border-r border-white/5">
            <div class="flex items-center gap-3 px-2">
                <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/20">
                    <i class="fas fa-bolt text-white text-lg"></i>
                </div>
                <h1 class="text-2xl font-extrabold tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-white to-zinc-400">VZO MUSIC</h1>
            </div>

            <nav class="flex flex-col gap-1">
                <button onclick="showHome()" class="sidebar-item flex items-center gap-4 text-white font-semibold p-3 rounded-xl bg-white/5">
                    <i class="fas fa-home-alt text-indigo-400"></i> Home
                </button>
            </nav>

            <div id="auth-section" class="mt-auto">
                <button id="login-btn" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-2xl text-sm transition-all shadow-xl shadow-indigo-500/10 active:scale-95">
                    Sign in with Spotify
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative overflow-y-auto bg-[#050505]">
            <div class="absolute top-0 left-0 w-full h-96 hero-gradient pointer-events-none"></div>

            <!-- Header -->
            <header class="sticky top-0 z-30 px-8 py-6 glass-header flex items-center justify-between">
                <div class="relative w-full max-w-2xl group">
                    <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-zinc-500 group-focus-within:text-indigo-400 transition-colors"></i>
                    <input 
                        id="search-input"
                        type="text" 
                        placeholder="Search for tracks..." 
                        class="w-full bg-white/5 border border-white/5 rounded-2xl py-4 pl-14 pr-6 text-sm focus:ring-2 focus:ring-indigo-500/50 transition-all outline-none placeholder:text-zinc-600"
                    >
                </div>
            </header>

            <!-- Scrollable Content -->
            <div id="content-area" class="relative z-10 px-8 py-8">
                <div id="home-view">
                    <div class="mb-12">
                        <h2 class="text-4xl font-extrabold mb-2 tracking-tight">Good evening</h2>
                        <p id="status-text" class="text-zinc-500 font-medium italic">Ready for music</p>
                    </div>

                    <section class="mb-12">
                        <h3 class="text-xl font-bold mb-6">Featured Tracks</h3>
                        <div id="featured-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 min-h-[200px]">
                            <!-- Injected -->
                        </div>
                    </section>

                    <section>
                        <h3 class="text-xl font-bold mb-6">Recently Played</h3>
                        <div id="recs-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 min-h-[200px]">
                            <!-- Injected -->
                        </div>
                    </section>
                </div>

                <div id="search-view" class="hidden">
                    <h2 id="search-title" class="text-3xl font-bold mb-8">Search Results</h2>
                    <div id="results-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                        <!-- Search cards will be injected here -->
                    </div>
                </div>
                
                <div id="loader" class="hidden flex flex-col items-center justify-center py-32">
                    <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
                    <p class="text-zinc-500 mt-6 font-medium tracking-wide">Connecting...</p>
                </div>
            </div>

            <div class="h-32"></div>
        </main>
    </div>

    <!-- Player Bar -->
    <footer class="h-28 bg-[#080808]/90 backdrop-blur-3xl border-t border-white/5 px-8 flex items-center justify-between z-40 relative">
        <div class="flex items-center gap-5 w-1/4">
            <div class="relative group">
                <img id="player-img" src="https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=300&h=300&fit=crop" class="w-16 h-16 rounded-xl shadow-2xl object-cover bg-zinc-800" alt="">
            </div>
            <div class="min-w-0">
                <h4 id="player-title" class="text-sm font-bold truncate text-white mb-1 tracking-tight">Waiting for track...</h4>
                <p id="player-artist" class="text-xs text-zinc-500 truncate font-medium">VZO Music</p>
            </div>
        </div>

        <div class="flex flex-col items-center gap-3 w-1/2 max-w-2xl px-8">
            <div class="flex items-center gap-8">
                <button class="text-zinc-300 hover:text-white transition-all text-xl"><i class="fas fa-step-backward"></i></button>
                <button id="master-play-btn" class="w-12 h-12 flex items-center justify-center bg-white rounded-full text-black hover:scale-110 active:scale-95 transition-all shadow-xl">
                    <i class="fas fa-play ml-1"></i>
                </button>
                <button class="text-zinc-300 hover:text-white transition-all text-xl"><i class="fas fa-step-forward"></i></button>
            </div>
            
            <div class="flex items-center gap-4 w-full group">
                <span id="current-time" class="text-[11px] font-bold text-zinc-500 w-10 text-right tabular-nums">0:00</span>
                <div class="relative flex-1 flex items-center">
                    <input id="progress-bar" type="range" value="0" step="0.1" class="w-full appearance-none bg-zinc-800 rounded-full h-1.5 cursor-pointer group-hover:bg-zinc-700">
                </div>
                <span id="duration" class="text-[11px] font-bold text-zinc-500 w-10 text-left tabular-nums">0:30</span>
            </div>
        </div>

        <div class="flex items-center justify-end gap-6 w-1/4">
            <div class="flex items-center gap-3 w-32 group">
                <i class="fas fa-volume-up text-zinc-500 text-xs group-hover:text-white transition-colors"></i>
                <input id="volume-bar" type="range" value="70" class="w-full appearance-none bg-zinc-800 rounded-full h-1 cursor-pointer">
            </div>
        </div>
    </footer>

    <audio id="main-audio"></audio>

    <script>
        const CLIENT_ID = '3e44756a158e487eb31540648769226f';
        const CLIENT_SECRET = 'bcf32f6a23c94b4987ad1822bf9ac517';
        const REDIRECT_URI = 'https://testacckn5.github.io/vusic/';
        
        const AUTH_ENDPOINT = "https://accounts.spotify.com/authorize";
        const TOKEN_ENDPOINT = "https://accounts.spotify.com/api/token";

        // FALLBACK CONTENT if API fails
        const FALLBACK_TRACKS = [
            { id: 'f1', name: "Midnight City", artists: [{name: "M83"}], album: { images: [{url: "https://images.unsplash.com/photo-1614613535308-eb5fbd3d2c17?w=400&h=400&fit=crop"}] }, preview_url: "https://p.scdn.co/mp3-preview/bc35c40bc333857d90d8c0b2c159045731383794" },
            { id: 'f2', name: "Blinding Lights", artists: [{name: "The Weeknd"}], album: { images: [{url: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?w=400&h=400&fit=crop"}] }, preview_url: "https://p.scdn.co/mp3-preview/82f182104193309a96e94999f8d6896173c3327f" },
            { id: 'f3', name: "Levitating", artists: [{name: "Dua Lipa"}], album: { images: [{url: "https://images.unsplash.com/photo-1493225255756-d9584f8606e9?w=400&h=400&fit=crop"}] }, preview_url: "https://p.scdn.co/mp3-preview/a911a36480e668600c01a0701b22e118ba8e66e3" },
            { id: 'f4', name: "Circles", artists: [{name: "Post Malone"}], album: { images: [{url: "https://images.unsplash.com/photo-1459749411177-042180ce673c?w=400&h=400&fit=crop"}] }, preview_url: "https://p.scdn.co/mp3-preview/a4e76a163999e0753086df1117b3510e11894a82" },
            { id: 'f5', name: "Stay", artists: [{name: "The Kid LAROI"}], album: { images: [{url: "https://images.unsplash.com/photo-1514525253344-032993215200?w=400&h=400&fit=crop"}] }, preview_url: "https://p.scdn.co/mp3-preview/250787e91d6046e7b4b1a41544253372f87cc456" }
        ];

        let accessToken = null;
        let currentTrackId = null;

        const loginBtn = document.getElementById('login-btn');
        const searchInput = document.getElementById('search-input');
        const homeView = document.getElementById('home-view');
        const searchView = document.getElementById('search-view');
        const resultsGrid = document.getElementById('results-grid');
        const featuredGrid = document.getElementById('featured-grid');
        const recsGrid = document.getElementById('recs-grid');
        const loader = document.getElementById('loader');
        const audio = document.getElementById('main-audio');
        const masterPlayBtn = document.getElementById('master-play-btn');
        const progressBar = document.getElementById('progress-bar');
        const volumeBar = document.getElementById('volume-bar');
        const statusText = document.getElementById('status-text');

        window.addEventListener('load', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            if (code) {
                window.history.replaceState({}, document.title, window.location.pathname);
                await fetchAccessToken(code);
            } else {
                // Show offline tracks initially if no login
                displayTracks(FALLBACK_TRACKS, featuredGrid);
                displayTracks(FALLBACK_TRACKS.slice().reverse(), recsGrid);
            }
        });

        loginBtn.addEventListener('click', () => {
            const authUrl = `${AUTH_ENDPOINT}?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=code&scope=user-read-private%20user-read-email&show_dialog=true`;
            window.location.href = authUrl;
        });

        async function fetchAccessToken(code) {
            loader.classList.remove('hidden');
            homeView.classList.add('hidden');
            try {
                const response = await fetch(TOKEN_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': 'Basic ' + btoa(CLIENT_ID + ':' + CLIENT_SECRET)
                    },
                    body: new URLSearchParams({
                        grant_type: 'authorization_code',
                        code: code,
                        redirect_uri: REDIRECT_URI
                    })
                });

                const data = await response.json();
                if (data.access_token) {
                    accessToken = data.access_token;
                    onLoggedIn();
                }
            } catch (err) {
                console.error("Token error:", err);
                statusText.innerText = "Connection failed. Using offline library.";
                onLoggedIn(); // Still enter "logged in" state to show grids
            } finally {
                loader.classList.add('hidden');
            }
        }

        function onLoggedIn() {
            document.getElementById('auth-section').innerHTML = `
                <div class="bg-indigo-500/10 rounded-2xl p-4 border border-indigo-500/20 text-center">
                    <p class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest mb-1">Status</p>
                    <p class="text-xs font-bold text-white">${accessToken ? 'Spotify Online' : 'Limited Mode'}</p>
                </div>
            `;
            homeView.classList.remove('hidden');
            loadHomeData();
        }

        async function spotifyFetch(endpoint) {
            if (!accessToken) return null;
            try {
                const res = await fetch(`https://api.spotify.org/v1/${endpoint}`, {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                if (!res.ok) return null;
                return await res.json();
            } catch (err) {
                console.warn("Spotify fetch error - probable block:", err);
                return null;
            }
        }

        async function loadHomeData() {
            statusText.innerText = "Syncing with Spotify...";
            
            try {
                const [featured, recommendations] = await Promise.all([
                    spotifyFetch('search?q=lofi%20beats&type=track&limit=10'),
                    spotifyFetch('search?q=hits%202025&type=track&limit=10')
                ]);
                
                if (featured && featured.tracks && featured.tracks.items.length > 0) {
                    displayTracks(featured.tracks.items, featuredGrid);
                } else {
                    displayTracks(FALLBACK_TRACKS, featuredGrid);
                }

                if (recommendations && recommendations.tracks && recommendations.tracks.items.length > 0) {
                    displayTracks(recommendations.tracks.items, recsGrid);
                } else {
                    displayTracks(FALLBACK_TRACKS.slice().reverse(), recsGrid);
                }
                
                statusText.innerText = accessToken ? "Spotify connection active" : "Offline mode active";
            } catch (e) {
                displayTracks(FALLBACK_TRACKS, featuredGrid);
                displayTracks(FALLBACK_TRACKS, recsGrid);
                statusText.innerText = "Load failed. Showing local tracks.";
            }
        }

        function showHome() {
            searchView.classList.add('hidden');
            homeView.classList.remove('hidden');
            searchInput.value = '';
        }

        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            if (query.length > 1) {
                searchTimeout = setTimeout(() => searchTracks(query), 500);
            } else if (query.length === 0) {
                showHome();
            }
        });

        async function searchTracks(query) {
            homeView.classList.add('hidden');
            searchView.classList.remove('hidden');
            resultsGrid.innerHTML = '<div class="col-span-full py-20 text-center text-zinc-500 animate-pulse">Searching...</div>';
            
            const data = await spotifyFetch(`search?q=${encodeURIComponent(query)}&type=track&limit=30`);
            if (data && data.tracks && data.tracks.items.length > 0) {
                displayTracks(data.tracks.items, resultsGrid);
            } else {
                resultsGrid.innerHTML = '<div class="col-span-full py-20 text-center text-zinc-500">No results. Try a more popular artist.</div>';
            }
        }

        function displayTracks(tracks, targetElement) {
            if (!tracks || tracks.length === 0) return;
            targetElement.innerHTML = tracks.map(track => {
                const preview = track.preview_url;
                const hasPreview = !!preview && preview !== 'null';
                return `
                <div onclick="playTrack('${preview}', '${track.name.replace(/'/g, "\\'")}', '${track.artists[0].name.replace(/'/g, "\\'")}', '${track.album.images[0]?.url}', '${track.id}')" 
                     class="spotify-card group p-4 rounded-2xl transition-all cursor-pointer">
                    <div class="relative mb-4 aspect-square">
                        <img src="${track.album.images[0]?.url || 'https://via.placeholder.com/300'}" class="rounded-xl object-cover w-full h-full shadow-lg bg-zinc-800" />
                        <div class="play-btn-overlay absolute bottom-3 right-3 w-10 h-10 ${hasPreview ? 'bg-indigo-500' : 'bg-zinc-700'} rounded-full flex items-center justify-center shadow-xl">
                            <i class="fas fa-${hasPreview ? 'play ml-0.5' : 'lock'} text-white text-xs"></i>
                        </div>
                    </div>
                    <h3 class="font-bold truncate text-sm text-white mb-0.5">${track.name}</h3>
                    <p class="text-zinc-500 text-[11px] truncate font-medium">${track.artists[0].name}</p>
                </div>
            `}).join('');
        }

        function playTrack(url, title, artist, img, id) {
            if (!url || url === 'null') {
                showToast("This track is unavailable for preview.");
                return;
            }
            if (currentTrackId === id) {
                togglePlay();
                return;
            }
            currentTrackId = id;
            audio.src = url;
            audio.play();
            
            document.getElementById('player-title').innerText = title;
            document.getElementById('player-artist').innerText = artist;
            document.getElementById('player-img').src = img;
            masterPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
        }

        function togglePlay() {
            if (!audio.src) return;
            if (audio.paused) {
                audio.play();
                masterPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audio.pause();
                masterPlayBtn.innerHTML = '<i class="fas fa-play ml-1"></i>';
            }
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = "fixed bottom-32 left-1/2 -translate-x-1/2 bg-zinc-900 border border-white/10 px-6 py-3 rounded-full text-[11px] font-bold text-white z-50 shadow-2xl transition-all";
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }

        masterPlayBtn.addEventListener('click', togglePlay);
        audio.ontimeupdate = () => {
            if (!audio.duration) return;
            progressBar.value = (audio.currentTime / audio.duration) * 100;
            document.getElementById('current-time').innerText = `0:${Math.floor(audio.currentTime).toString().padStart(2, '0')}`;
            document.getElementById('duration').innerText = `0:${Math.floor(audio.duration).toString().padStart(2, '0')}`;
        };
        progressBar.oninput = () => audio.currentTime = (progressBar.value / 100) * audio.duration;
        volumeBar.oninput = () => audio.volume = volumeBar.value / 100;
    </script>
</body>
</html>
