<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vzo's music app</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #050505;
            color: #fff;
            overflow: hidden;
        }

        .sidebar-item {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateX(4px);
        }

        .glass-header {
            background: rgba(5, 5, 5, 0.8);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .spotify-card {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .spotify-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-8px);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .play-btn-overlay {
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .spotify-card:hover .play-btn-overlay {
            opacity: 1;
            transform: translateY(0);
        }

        input[type='range'] {
            accent-color: #6366f1;
            height: 4px;
        }

        .hero-gradient {
            background: linear-gradient(180deg, rgba(99, 102, 241, 0.15) 0%, rgba(5, 5, 5, 0) 100%);
        }

        ::-webkit-scrollbar {
            width: 5px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #222;
            border-radius: 10px;
        }
    </style>
</head>
<body class="h-screen flex flex-col selection:bg-indigo-500/30">

    <!-- App Container -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-72 bg-[#0a0a0a] p-6 hidden md:flex flex-col gap-8 border-r border-white/5">
            <div class="flex items-center gap-3 px-2">
                <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/20">
                    <i class="fas fa-bolt text-white text-lg"></i>
                </div>
                <h1 class="text-2xl font-extrabold tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-white to-zinc-400">VZO MUSIC</h1>
            </div>

            <nav class="flex flex-col gap-1">
                <button onclick="showHome()" class="sidebar-item flex items-center gap-4 text-white font-semibold p-3 rounded-xl bg-white/5">
                    <i class="fas fa-home-alt text-indigo-400"></i> Home
                </button>
                <button class="sidebar-item flex items-center gap-4 text-zinc-400 hover:text-white p-3 rounded-xl">
                    <i class="fas fa-compass"></i> Explore
                </button>
                <button class="sidebar-item flex items-center gap-4 text-zinc-400 hover:text-white p-3 rounded-xl">
                    <i class="fas fa-heart"></i> Favorites
                </button>
            </nav>

            <div class="flex flex-col gap-4">
                <p class="text-[10px] font-bold text-zinc-600 uppercase tracking-[0.2em] px-3">Your Library</p>
                <div class="space-y-1">
                    <button class="sidebar-item w-full text-left text-sm text-zinc-400 hover:text-white p-3 rounded-xl flex items-center gap-3">
                        <div class="w-2 h-2 rounded-full bg-indigo-500"></div> Coding Focus
                    </button>
                    <button class="sidebar-item w-full text-left text-sm text-zinc-400 hover:text-white p-3 rounded-xl flex items-center gap-3">
                        <div class="w-2 h-2 rounded-full bg-purple-500"></div> Late Night
                    </button>
                </div>
            </div>

            <div id="auth-section" class="mt-auto">
                <button id="login-btn" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-4 rounded-2xl text-sm transition-all shadow-xl shadow-indigo-500/10 active:scale-95">
                    Sign in with Spotify
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative overflow-y-auto bg-[#050505]">
            <!-- Hero Gradient Decorator -->
            <div class="absolute top-0 left-0 w-full h-96 hero-gradient pointer-events-none"></div>

            <!-- Header -->
            <header class="sticky top-0 z-30 px-8 py-4 glass-header flex items-center justify-between">
                <div class="relative w-full max-w-xl group">
                    <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-zinc-500 group-focus-within:text-indigo-400 transition-colors"></i>
                    <input 
                        id="search-input"
                        type="text" 
                        placeholder="Search for tracks, artists, or albums..." 
                        class="w-full bg-white/5 border border-white/5 rounded-2xl py-3.5 pl-14 pr-6 text-sm focus:ring-2 focus:ring-indigo-500/50 transition-all outline-none placeholder:text-zinc-600"
                    >
                </div>
                <div class="flex items-center gap-4">
                    <button class="w-10 h-10 rounded-full border border-white/10 flex items-center justify-center text-zinc-400 hover:text-white hover:border-white/20 transition-all">
                        <i class="far fa-bell"></i>
                    </button>
                    <div class="w-10 h-10 rounded-full bg-zinc-800 border border-white/10 p-0.5 overflow-hidden">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=vzo" alt="Avatar" class="w-full h-full rounded-full bg-indigo-900">
                    </div>
                </div>
            </header>

            <!-- Scrollable Content -->
            <div id="content-area" class="relative z-10 px-8 py-8">
                <div id="home-view">
                    <div class="mb-12">
                        <h2 class="text-4xl font-extrabold mb-2 tracking-tight">Good evening, Vzo</h2>
                        <p class="text-zinc-500 font-medium">Here's what we've picked for you today.</p>
                    </div>

                    <section class="mb-12">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold">Featured Mixes</h3>
                            <button class="text-xs font-bold text-indigo-400 hover:text-indigo-300 uppercase tracking-widest">See All</button>
                        </div>
                        <div id="featured-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 min-h-[200px]">
                            <!-- Injected -->
                        </div>
                    </section>

                    <section>
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold">Based on your taste</h3>
                            <button class="text-xs font-bold text-indigo-400 hover:text-indigo-300 uppercase tracking-widest">See All</button>
                        </div>
                        <div id="recs-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 min-h-[200px]">
                            <!-- Injected -->
                        </div>
                    </section>
                </div>

                <div id="search-view" class="hidden">
                    <h2 id="search-title" class="text-3xl font-bold mb-8">Search Results</h2>
                    <div id="results-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                        <!-- Search cards will be injected here -->
                    </div>
                </div>
                
                <div id="loader" class="hidden flex flex-col items-center justify-center py-32">
                    <div class="relative">
                        <div class="w-16 h-16 border-4 border-indigo-500/20 rounded-full"></div>
                        <div class="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin absolute top-0 left-0"></div>
                    </div>
                    <p class="text-zinc-500 mt-6 font-medium tracking-wide">Vzo's music is loading...</p>
                </div>
            </div>

            <div class="h-32"></div>
        </main>
    </div>

    <!-- Player Bar -->
    <footer class="h-28 bg-[#080808]/90 backdrop-blur-3xl border-t border-white/5 px-8 flex items-center justify-between z-40 relative">
        <!-- Current Track -->
        <div class="flex items-center gap-5 w-1/4">
            <div class="relative group">
                <img id="player-img" src="https://via.placeholder.com/80" class="w-16 h-16 rounded-xl shadow-2xl shadow-indigo-500/10 object-cover bg-zinc-800 transition-transform group-hover:scale-105" alt="">
                <button class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center rounded-xl transition-opacity">
                    <i class="fas fa-expand text-white text-xs"></i>
                </button>
            </div>
            <div class="min-w-0">
                <h4 id="player-title" class="text-sm font-bold truncate text-white mb-1 tracking-tight">Vzo Music Player</h4>
                <p id="player-artist" class="text-xs text-zinc-500 truncate font-medium">Select a track to start</p>
            </div>
            <button class="text-zinc-600 hover:text-pink-500 transition-colors ml-2">
                <i class="far fa-heart"></i>
            </button>
        </div>

        <!-- Controls -->
        <div class="flex flex-col items-center gap-3 w-1/2 max-w-2xl px-8">
            <div class="flex items-center gap-8">
                <button class="text-zinc-500 hover:text-white transition-colors"><i class="fas fa-random text-sm"></i></button>
                <button class="text-zinc-300 hover:text-white transition-all text-xl"><i class="fas fa-step-backward"></i></button>
                <button id="master-play-btn" class="w-12 h-12 flex items-center justify-center bg-white rounded-full text-black hover:scale-110 active:scale-95 transition-all shadow-xl shadow-white/10">
                    <i class="fas fa-play ml-1"></i>
                </button>
                <button class="text-zinc-300 hover:text-white transition-all text-xl"><i class="fas fa-step-forward"></i></button>
                <button class="text-zinc-500 hover:text-white transition-colors"><i class="fas fa-redo text-sm"></i></button>
            </div>
            
            <div class="flex items-center gap-4 w-full group">
                <span id="current-time" class="text-[11px] font-bold text-zinc-500 w-10 text-right tabular-nums">0:00</span>
                <div class="relative flex-1 flex items-center">
                    <input id="progress-bar" type="range" value="0" step="0.1" class="w-full appearance-none bg-zinc-800 rounded-full h-1.5 cursor-pointer group-hover:bg-zinc-700">
                </div>
                <span id="duration" class="text-[11px] font-bold text-zinc-500 w-10 text-left tabular-nums">0:30</span>
            </div>
        </div>

        <!-- Volume/Extras -->
        <div class="flex items-center justify-end gap-6 w-1/4">
            <button class="text-zinc-400 hover:text-indigo-400 transition-colors"><i class="fas fa-microphone-lines text-sm"></i></button>
            <div class="flex items-center gap-3 w-32 group">
                <i class="fas fa-volume-up text-zinc-500 text-xs group-hover:text-white transition-colors"></i>
                <input id="volume-bar" type="range" value="70" class="w-full appearance-none bg-zinc-800 rounded-full h-1 cursor-pointer">
            </div>
        </div>
    </footer>

    <audio id="main-audio"></audio>

    <script>
        const CLIENT_ID = '3e44756a158e487eb31540648769226f';
        const CLIENT_SECRET = 'bcf32f6a23c94b4987ad1822bf9ac517';
        const REDIRECT_URI = 'https://testacckn5.github.io/vusic/';
        
        const AUTH_ENDPOINT = "https://accounts.spotify.com/authorize";
        const TOKEN_ENDPOINT = "https://accounts.spotify.com/api/token";
        const SCOPES = "user-read-private user-read-email";

        let accessToken = null;
        let currentTrackId = null;

        const loginBtn = document.getElementById('login-btn');
        const searchInput = document.getElementById('search-input');
        const homeView = document.getElementById('home-view');
        const searchView = document.getElementById('search-view');
        const resultsGrid = document.getElementById('results-grid');
        const featuredGrid = document.getElementById('featured-grid');
        const recsGrid = document.getElementById('recs-grid');
        const loader = document.getElementById('loader');
        const audio = document.getElementById('main-audio');
        const masterPlayBtn = document.getElementById('master-play-btn');
        const progressBar = document.getElementById('progress-bar');
        const volumeBar = document.getElementById('volume-bar');

        window.addEventListener('load', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            if (code) {
                window.history.replaceState({}, document.title, window.location.pathname);
                await fetchAccessToken(code);
            }
        });

        loginBtn.addEventListener('click', () => {
            const authUrl = `${AUTH_ENDPOINT}?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=code&scope=${encodeURIComponent(SCOPES)}&show_dialog=true`;
            window.location.href = authUrl;
        });

        async function fetchAccessToken(code) {
            loader.classList.remove('hidden');
            homeView.classList.add('hidden');
            try {
                const response = await fetch(TOKEN_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': 'Basic ' + btoa(CLIENT_ID + ':' + CLIENT_SECRET)
                    },
                    body: new URLSearchParams({
                        grant_type: 'authorization_code',
                        code: code,
                        redirect_uri: REDIRECT_URI
                    })
                });

                const data = await response.json();
                if (data.access_token) {
                    accessToken = data.access_token;
                    onLoggedIn();
                } else {
                    console.error("Token exchange failed", data);
                }
            } catch (err) {
                console.error("Token error:", err);
            } finally {
                loader.classList.add('hidden');
            }
        }

        function onLoggedIn() {
            document.getElementById('auth-section').innerHTML = `
                <div class="bg-indigo-500/10 rounded-2xl p-5 border border-indigo-500/20 text-center">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-[10px] font-bold text-white">V</div>
                        <div class="text-left">
                            <p class="text-[10px] font-bold text-zinc-500 uppercase tracking-widest">Premium User</p>
                            <p class="text-sm font-bold text-white">Vzo Connected</p>
                        </div>
                    </div>
                    <div class="w-full h-1 bg-white/5 rounded-full overflow-hidden">
                        <div class="w-full h-full bg-indigo-500"></div>
                    </div>
                </div>
            `;
            homeView.classList.remove('hidden');
            loadHomeData();
        }

        function showHome() {
            searchView.classList.add('hidden');
            homeView.classList.remove('hidden');
            searchInput.value = '';
        }

        async function loadHomeData() {
            if (!accessToken) return;
            
            // Show loaders in the specific grids
            featuredGrid.innerHTML = '<div class="col-span-full py-10 text-center text-zinc-600">Syncing Featured...</div>';
            recsGrid.innerHTML = '<div class="col-span-full py-10 text-center text-zinc-600">Picking for you...</div>';

            try {
                // Fetch two different "moods" for the home page
                const [featured, recommendations] = await Promise.all([
                    spotifyFetch('search?q=lofi%20beats&type=track&limit=10'),
                    spotifyFetch('search?q=popular%202025&type=track&limit=15')
                ]);
                
                if (featured && featured.tracks) {
                    displayTracks(featured.tracks.items, featuredGrid);
                } else {
                    featuredGrid.innerHTML = '<div class="col-span-full text-zinc-500">Could not load mixes.</div>';
                }

                if (recommendations && recommendations.tracks) {
                    displayTracks(recommendations.tracks.items, recsGrid);
                } else {
                    recsGrid.innerHTML = '<div class="col-span-full text-zinc-500">Could not load recommendations.</div>';
                }
            } catch (e) {
                console.error("Home load error", e);
            }
        }

        async function spotifyFetch(endpoint) {
            if (!accessToken) return null;
            try {
                const res = await fetch(`https://api.spotify.org/v1/${endpoint}`, {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                if (!res.ok) {
                    if (res.status === 401) {
                        // Potential token expiry - simple app just asks to re-login
                        showToast("Session expired. Please refresh.");
                    }
                    return null;
                }
                return await res.json();
            } catch (err) {
                console.error("Fetch failed", err);
                return null;
            }
        }

        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim();
            if (query.length > 2) {
                searchTimeout = setTimeout(() => searchTracks(query), 400);
            } else if (query.length === 0) {
                showHome();
            }
        });

        async function searchTracks(query) {
            if (!accessToken) return;
            homeView.classList.add('hidden');
            searchView.classList.remove('hidden');
            resultsGrid.innerHTML = '<div class="col-span-full py-20 text-center text-zinc-500 animate-pulse">Searching the catalog...</div>';
            
            try {
                const data = await spotifyFetch(`search?q=${encodeURIComponent(query)}&type=track&limit=30`);
                if (data && data.tracks && data.tracks.items.length > 0) {
                    displayTracks(data.tracks.items, resultsGrid);
                } else {
                    resultsGrid.innerHTML = '<div class="col-span-full py-20 text-center text-zinc-500">No tracks found. Try something else.</div>';
                }
            } catch (err) {
                resultsGrid.innerHTML = '<div class="col-span-full py-20 text-center text-red-500/50">Search failed. Check connection.</div>';
            }
        }

        function displayTracks(tracks, targetElement) {
            if (!tracks || tracks.length === 0) {
                targetElement.innerHTML = '<div class="col-span-full text-zinc-600 py-10">No items available.</div>';
                return;
            }
            targetElement.innerHTML = tracks.map(track => {
                const preview = track.preview_url;
                const hasPreview = !!preview && preview !== 'null';
                return `
                <div onclick="playTrack('${preview}', '${track.name.replace(/'/g, "\\'")}', '${track.artists[0].name.replace(/'/g, "\\'")}', '${track.album.images[0]?.url}', '${track.id}')" 
                     class="spotify-card group p-5 rounded-2xl transition-all cursor-pointer">
                    <div class="relative mb-4 aspect-square">
                        <img src="${track.album.images[0]?.url || 'https://via.placeholder.com/300'}" class="rounded-xl object-cover w-full h-full shadow-lg bg-zinc-800" />
                        <div class="play-btn-overlay absolute bottom-3 right-3 w-12 h-12 ${hasPreview ? 'bg-indigo-500' : 'bg-zinc-700'} rounded-full flex items-center justify-center shadow-xl">
                            <i class="fas fa-${hasPreview ? 'play ml-0.5' : 'lock'} text-white text-sm"></i>
                        </div>
                    </div>
                    <h3 class="font-bold truncate text-sm text-white mb-1">${track.name}</h3>
                    <p class="text-zinc-500 text-xs truncate font-medium">${track.artists[0].name}</p>
                    ${!hasPreview ? '<div class="mt-2 text-[9px] font-bold text-zinc-700 bg-white/5 inline-block px-2 py-0.5 rounded tracking-tighter">RESTRICTED</div>' : ''}
                </div>
            `}).join('');
        }

        function playTrack(url, title, artist, img, id) {
            if (!url || url === 'null') {
                showToast("Full track required. This is a restricted preview.");
                return;
            }
            if (currentTrackId === id) {
                togglePlay();
                return;
            }
            currentTrackId = id;
            audio.src = url;
            audio.play();
            
            document.getElementById('player-title').innerText = title;
            document.getElementById('player-artist').innerText = artist;
            document.getElementById('player-img').src = img;
            masterPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
            masterPlayBtn.classList.add('bg-indigo-500', 'text-white');
            masterPlayBtn.classList.remove('bg-white', 'text-black');
        }

        function togglePlay() {
            if (!audio.src) return;
            if (audio.paused) {
                audio.play();
                masterPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audio.pause();
                masterPlayBtn.innerHTML = '<i class="fas fa-play ml-1"></i>';
            }
        }

        function showToast(msg) {
            const toast = document.createElement('div');
            toast.className = "fixed bottom-32 left-1/2 -translate-x-1/2 bg-zinc-900 border border-white/10 px-6 py-3 rounded-full text-xs font-bold text-white shadow-2xl z-50 transition-all transform scale-90";
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.classList.add('scale-100');
            }, 10);
            setTimeout(() => {
                toast.classList.add('opacity-0', 'scale-90');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        masterPlayBtn.addEventListener('click', togglePlay);
        audio.ontimeupdate = () => {
            if (!audio.duration) return;
            progressBar.value = (audio.currentTime / audio.duration) * 100;
            document.getElementById('current-time').innerText = `0:${Math.floor(audio.currentTime).toString().padStart(2, '0')}`;
        };
        progressBar.oninput = () => audio.currentTime = (progressBar.value / 100) * audio.duration;
        volumeBar.oninput = () => audio.volume = volumeBar.value / 100;
    </script>
</body>
</html>
