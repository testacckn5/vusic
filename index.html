<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vzo's music app</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000;
            color: #fff;
            overflow: hidden;
        }

        .glass-header {
            background: rgba(9, 9, 11, 0.7);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(39, 39, 42, 0.5);
        }

        .spotify-card:hover .play-btn {
            opacity: 1;
            transform: translateY(0);
        }

        input[type='range'] {
            accent-color: #6366f1;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #27272a;
            border-radius: 10px;
        }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- App Container -->
    <div class="flex flex-1 overflow-hidden">
        
        <!-- Sidebar -->
        <aside class="w-64 bg-zinc-950 p-6 hidden md:flex flex-col gap-8 border-r border-zinc-900">
            <div class="flex items-center gap-2 px-2">
                <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-music text-white text-sm"></i>
                </div>
                <h1 class="text-xl font-bold tracking-tight">vzo's music</h1>
            </div>

            <nav class="flex flex-col gap-5">
                <a href="#" class="flex items-center gap-4 text-white font-semibold px-2">
                    <i class="fas fa-home text-lg"></i> Home
                </a>
                <a href="#" class="flex items-center gap-4 text-zinc-400 hover:text-white transition px-2">
                    <i class="fas fa-search text-lg"></i> Search
                </a>
            </nav>

            <div id="auth-section" class="mt-auto">
                <button id="login-btn" class="w-full bg-white text-black font-bold py-3 rounded-full text-sm hover:scale-105 transition shadow-lg shadow-white/10">
                    Login with Spotify
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col relative overflow-y-auto bg-gradient-to-b from-zinc-900 to-black">
            <header class="sticky top-0 z-10 p-6 glass-header flex items-center justify-between">
                <div class="relative w-full max-w-md">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-zinc-500"></i>
                    <input 
                        id="search-input"
                        type="text" 
                        placeholder="Search for tracks..." 
                        class="w-full bg-zinc-800/80 border-none rounded-full py-2.5 pl-12 pr-4 text-sm focus:ring-2 focus:ring-indigo-500 transition outline-none"
                    >
                </div>
            </header>

            <div id="content-area" class="p-8">
                <h2 id="view-title" class="text-3xl font-bold mb-8">Ready to play?</h2>
                <div id="results-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
                    <!-- Cards will be injected here -->
                </div>
                
                <div id="loader" class="hidden flex flex-col items-center justify-center py-20">
                    <i class="fas fa-circle-notch animate-spin text-indigo-500 text-4xl mb-4"></i>
                    <p class="text-zinc-500">Connecting to Spotify...</p>
                </div>
            </div>

            <div class="h-28"></div>
        </main>
    </div>

    <!-- Player Bar -->
    <footer class="h-24 bg-black border-t border-zinc-900 px-4 flex items-center justify-between z-20">
        <div class="flex items-center gap-4 w-1/3 min-w-0">
            <img id="player-img" src="https://via.placeholder.com/60" class="w-14 h-14 rounded shadow-lg bg-zinc-800" alt="">
            <div class="overflow-hidden">
                <h4 id="player-title" class="text-sm font-medium truncate">No track selected</h4>
                <p id="player-artist" class="text-xs text-zinc-400 truncate">Login to search music</p>
            </div>
        </div>

        <div class="flex flex-col items-center gap-2 w-1/3 max-w-xl">
            <div class="flex items-center gap-8">
                <button id="master-play-btn" class="w-10 h-10 flex items-center justify-center bg-white rounded-full text-black hover:scale-105 transition shadow-lg">
                    <i class="fas fa-play ml-1"></i>
                </button>
            </div>
            <div class="flex items-center gap-3 w-full">
                <span id="current-time" class="text-[10px] text-zinc-500 w-10 text-right">0:00</span>
                <input id="progress-bar" type="range" value="0" step="0.1" class="flex-1 h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer">
                <span id="duration" class="text-[10px] text-zinc-500 w-10 text-left">0:30</span>
            </div>
        </div>

        <div class="flex items-center justify-end gap-4 w-1/3">
            <div class="flex items-center gap-2 w-28">
                <i class="fas fa-volume-up text-zinc-400 text-xs"></i>
                <input id="volume-bar" type="range" value="70" class="w-full h-1 bg-zinc-700 rounded-lg appearance-none cursor-pointer">
            </div>
        </div>
    </footer>

    <audio id="main-audio"></audio>

    <script>
        // CREDENTIALS
        const CLIENT_ID = '3e44756a158e487eb31540648769226f';
        const CLIENT_SECRET = 'bcf32f6a23c94b4987ad1822bf9ac517';
        const REDIRECT_URI = 'https://testacckn5.github.io/vusic/';
        
        const AUTH_ENDPOINT = "https://accounts.spotify.com/authorize";
        const TOKEN_ENDPOINT = "https://accounts.spotify.com/api/token";
        const SCOPES = "user-read-private user-read-email";

        let accessToken = null;
        let currentTrackId = null;

        const loginBtn = document.getElementById('login-btn');
        const searchInput = document.getElementById('search-input');
        const resultsGrid = document.getElementById('results-grid');
        const viewTitle = document.getElementById('view-title');
        const loader = document.getElementById('loader');
        const audio = document.getElementById('main-audio');
        const masterPlayBtn = document.getElementById('master-play-btn');
        const progressBar = document.getElementById('progress-bar');
        const volumeBar = document.getElementById('volume-bar');

        // Handle URL parameters on load
        window.addEventListener('load', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const error = urlParams.get('error');

            if (code) {
                // Clear the code from the URL for a clean look
                window.history.replaceState({}, document.title, window.location.pathname);
                await fetchAccessToken(code);
            } else if (error) {
                viewTitle.innerHTML = `<div class="text-red-500">Auth Error: ${error}</div>`;
            }
        });

        // STEP 1: Get Authorization Code
        loginBtn.addEventListener('click', () => {
            const authUrl = `${AUTH_ENDPOINT}?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=code&scope=${encodeURIComponent(SCOPES)}&show_dialog=true`;
            window.location.href = authUrl;
        });

        // STEP 2: Exchange Code for Access Token using Client Secret
        async function fetchAccessToken(code) {
            loader.classList.remove('hidden');
            try {
                const response = await fetch(TOKEN_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'Authorization': 'Basic ' + btoa(CLIENT_ID + ':' + CLIENT_SECRET)
                    },
                    body: new URLSearchParams({
                        grant_type: 'authorization_code',
                        code: code,
                        redirect_uri: REDIRECT_URI
                    })
                });

                const data = await response.json();
                if (data.access_token) {
                    accessToken = data.access_token;
                    onLoggedIn();
                } else {
                    throw new Error(data.error_description || 'Failed to get token');
                }
            } catch (err) {
                viewTitle.innerHTML = `<div class="text-red-500">Token Error: ${err.message}</div>`;
            } finally {
                loader.classList.add('hidden');
            }
        }

        function onLoggedIn() {
            document.getElementById('auth-section').innerHTML = `
                <div class="bg-zinc-900 rounded-lg p-4 border border-zinc-800 text-center">
                    <p class="text-xs text-zinc-500 mb-1">Status</p>
                    <p class="text-sm font-bold text-indigo-400">VZO Connected</p>
                </div>
            `;
            viewTitle.innerText = "Discover Music";
            searchTracks('Top Hits'); 
        }

        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchTracks(searchInput.value);
        });

        async function searchTracks(query) {
            if (!accessToken) return;
            loader.classList.remove('hidden');
            resultsGrid.innerHTML = '';
            
            try {
                const response = await fetch(`https://api.spotify.org/v1/search?q=${encodeURIComponent(query)}&type=track&limit=20`, {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const data = await response.json();
                if (data.tracks && data.tracks.items) {
                    displayTracks(data.tracks.items);
                }
            } catch (err) {
                console.error(err);
            } finally {
                loader.classList.add('hidden');
            }
        }

        function displayTracks(tracks) {
            resultsGrid.innerHTML = tracks.map(track => `
                <div onclick="playTrack('${track.preview_url}', '${track.name.replace(/'/g, "\\'")}', '${track.artists[0].name.replace(/'/g, "\\'")}', '${track.album.images[0]?.url}', '${track.id}')" 
                     class="spotify-card bg-zinc-900/40 p-4 rounded-xl hover:bg-zinc-800 transition group cursor-pointer border border-zinc-800/50">
                    <div class="relative mb-4 aspect-square">
                        <img src="${track.album.images[0]?.url || 'https://via.placeholder.com/300'}" class="rounded-lg object-cover w-full h-full shadow-2xl" />
                        <div class="play-btn absolute bottom-2 right-2 w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center shadow-2xl transition opacity-0 transform translate-y-2">
                            <i class="fas fa-play text-white text-xs ml-0.5"></i>
                        </div>
                    </div>
                    <h3 class="font-bold truncate text-sm">${track.name}</h3>
                    <p class="text-zinc-400 text-xs truncate mt-1">${track.artists[0].name}</p>
                </div>
            `).join('');
        }

        function playTrack(url, title, artist, img, id) {
            if (!url) {
                const errorBox = document.createElement('div');
                errorBox.className = "fixed top-4 right-4 bg-zinc-900 border border-zinc-700 p-4 rounded-lg z-50 text-xs animate-bounce";
                errorBox.innerText = "Preview unavailable for this track.";
                document.body.appendChild(errorBox);
                setTimeout(() => errorBox.remove(), 2000);
                return;
            }
            if (currentTrackId === id) {
                togglePlay();
                return;
            }
            currentTrackId = id;
            audio.src = url;
            audio.play();
            document.getElementById('player-title').innerText = title;
            document.getElementById('player-artist').innerText = artist;
            document.getElementById('player-img').src = img;
            masterPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
        }

        function togglePlay() {
            if (!audio.src) return;
            if (audio.paused) {
                audio.play();
                masterPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                audio.pause();
                masterPlayBtn.innerHTML = '<i class="fas fa-play ml-1"></i>';
            }
        }

        masterPlayBtn.addEventListener('click', togglePlay);
        audio.ontimeupdate = () => {
            progressBar.value = (audio.currentTime / audio.duration) * 100 || 0;
            document.getElementById('current-time').innerText = `0:${Math.floor(audio.currentTime).toString().padStart(2, '0')}`;
        };
        progressBar.oninput = () => audio.currentTime = (progressBar.value / 100) * audio.duration;
        volumeBar.oninput = () => audio.volume = volumeBar.value / 100;
    </script>
</body>
</html>
